#!/usr/bin/env bash
# Regenerate per-agency manifest-generate-<agency> wrappers
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(cd "$SCRIPT_DIR/../../.." && pwd)"
BIN_DIR="$SCRIPT_DIR"

echo "Syncing manifest-generate wrappers from $PROJECT_ROOT/builds"
for d in "$PROJECT_ROOT/builds"/*; do
    if [[ -d "$d" ]]; then
        agency=$(basename "$d")
        # skip non-agency entries
        if [[ "$agency" == "manifests" || "$agency" == "tmp" ]]; then
            continue
        fi
        target="$BIN_DIR/manifest-generate-$agency"
        cat > "$target" <<EOF
#!/usr/bin/env bash
SCRIPT_DIR="
$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)
"
MANIFEST="\$SCRIPT_DIR/../commands/manifest-utils/manifest"
exec "\$MANIFEST" generate agency $agency
EOF
        chmod +x "$target"
        echo "  Created/updated: $target"
    fi
done

echo "Sync complete."
